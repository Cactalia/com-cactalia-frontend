<div class="row container-fluid card shadow px-0 pt-4 pb-4 mx-0 mb-4">   
    <form class="col-12" [formGroup]="detailForm">
        <div class="row">
            <div class="col-12">
                <h5>Guía de evaluación</h5>
            </div>
            <div class="col-12">
                <h6>Información general</h6>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-12 col-md-2">
                <label for="version">Versión</label>
                <input formControlName="version" type="text" class="form-control" id="version" maxlength="29">
            </div>
            <div class="form-group col-12 col-md-7">
                <label for="learningUnitName">Unidad de aprendizaje</label>
                <input formControlName="learningUnitName" type="text" class="form-control" id="learningUnitName" maxlength="29">
            </div>
            <div class="form-group col-12 col-md-3">
                <label for="status">Estado</label>
                <input formControlName="status" type="text" class="form-control" id="status" maxlength="29">
            </div>
        </div>
        <div class="row">
            <div class="form-group col-12 col-md-4">
                <label for="creationDate">Fecha de asignación</label>
                <input formControlName="creationDate" type="text" class="form-control" id="creationDate" maxlength="29">
            </div>
            <div class="form-group col-12 col-md-4">
                <label for="approvalDate">Fecha de aprobación</label>
                <input formControlName="approvalDate" type="text" class="form-control" id="approvalDate" maxlength="29">
            </div>
        </div>        
        
        <div class="row">
            <div class="form-group col-12">
                <label for="presentation">Presentación de la guía</label>
                <textarea formControlName="presentation" class="form-control" id="presentation" rows="1" [class.is-invalid]="detailForm.get('presentation').errors">
                </textarea>
                <small *ngIf="detailForm.get('presentation').errors?.required" class="form-text text-danger">Requerido.</small>
                <small *ngIf="detailForm.get('presentation').errors?.pattern" class="form-text text-danger">No valido.</small>
                <small *ngIf="detailForm.get('presentation').errors?.maxlength" class="form-text text-danger">Máximo 2000 caractéres.</small>
            </div>
        </div>
    </form>
</div>
<div class="row container-fluid card shadow px-0 mt-4 pt-4 pb-4 mx-0 mb-4">   
    <form class="col-12" [formGroup]="thematicUnitForm">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h5>Unidades temáticas</h5>
            </div>
            <div class="col-12">
                <h6>Diseño de la evaluación: Factores, Criterios e Indicadores.</h6>
            </div>
        </div>
        <div *ngFor="let thematicUnit of thematicUnits; let i = index">
            <div class="row">
                <div class="form-group col-12">
                    <label>Nombre</label>
                    <input type="text" class="form-control" value="{{thematicUnit.name}}" disabled>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-12">
                    <label>Factores</label>
                    <textarea type="text" class="form-control" value="{{thematicUnit.objective}}" disabled rows="1" >
                    </textarea>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-12">
                    <label>Criterios</label>
                    <textarea type="text" class="form-control" value="{{thematicUnit.topics}}" disabled rows="1" >
                    </textarea>
                </div>
            </div>
            <div class="row" *ngIf="thematicUnit.indicators != null">
                <div class="form-group col-12">
                    <label>Indicador</label>
                    <textarea type="text" class="form-control" value="{{thematicUnit.indicators}}" disabled rows="1" >
                    </textarea>
                </div>
            </div>
            <div class="row" *ngIf="thematicUnit.indicators == null">
                <div class="form-group col-12">
                    <label for="thematicUnitIndicators">Indicadores</label>
                    <textarea formControlName="thematicUnitIndicators" type="text" class="form-control" id="thematicUnitIndicators" rows="1" [class.is-invalid]="thematicUnitForm.get('thematicUnitIndicators').errors">
                    </textarea>
                    <small *ngIf="thematicUnitForm.get('thematicUnitIndicators').errors?.required" class="form-text text-danger">Requerido.</small>
                    <small *ngIf="thematicUnitForm.get('thematicUnitIndicators').errors?.maxlength" class="form-text text-danger">Máximo 100 caractéres.</small>
                </div>
            </div>
            <div class="row" *ngIf="thematicUnit.indicators == null">
                <div class="col-12 d-flex justify-content-end">
                    <button class="btn btn-primary d-flex ml-2" (click)="updateThematicUnit(i)">
                        <span class="material-icons text-light mr-1">add</span>
                        Guardar
                    </button>
                </div>
            </div>
            <hr *ngIf="i != thematicUnits.length-1">
        </div>      
    </form>
</div>

<div class="row container-fluid card shadow px-0 mt-4 pt-4 pb-4 mx-0 mb-4">   
    <form class="col-12" [formGroup]="scoreMeasurementForm" (ngSubmit)="newScoreMeasurement()">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h5>Diseño de los instrumentos de observación</h5>
                <button class="btn btn-primary d-flex" type="button" (click)="newScoreMeasurementRequest()">
                    <span class="material-icons text-light mr-1">add</span>
                    Agregar
                </button>
            </div>
            <div class="col-12">
                <h6>Mediciones que derivan en puntajes</h6>
            </div>
        </div>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Indicador</th>
                    <th>Evaluación</th>
                    <th>Instrumento</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let scoreMeasurement of scoreMeasurements; let i = index">
                    <td>
                        <textarea class="form-control" type="text" value="{{scoreMeasurement.indicator}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{scoreMeasurement.evaluation}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{scoreMeasurement.instrument}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <button class="btn btn-danger ml-2"  type="button" (click)="deleteScoreMeasurement(i)">Eliminar</button>
                    </td>
                    <hr *ngIf="i != scoreMeasurements.length-1">
                </tr>
                <tr *ngIf="scoreMeasurementRequest">
                    <td >
                        <input formControlName="scoreMtIndicator" type="text" class="form-control" id="scoreMtIndicator" [class.is-invalid]="scoreMeasurementForm.get('scoreMtIndicator').errors" />
                        <small *ngIf="scoreMeasurementForm.get('scoreMtIndicator').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="scoreMeasurementForm.get('scoreMtIndicator').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="scoreMtEvaluation" type="text" class="form-control" id="scoreMtEvaluation" [class.is-invalid]="scoreMeasurementForm.get('scoreMtEvaluation').errors" />
                        <small *ngIf="scoreMeasurementForm.get('scoreMtEvaluation').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="scoreMeasurementForm.get('scoreMtEvaluation').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="scoreMtInstrument" type="text" class="form-control" id="scoreMtInstrument" [class.is-invalid]="scoreMeasurementForm.get('scoreMtInstrument').errors" />
                        <small *ngIf="scoreMeasurementForm.get('scoreMtInstrument').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="scoreMeasurementForm.get('scoreMtInstrument').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <button class="btn btn-secondary d-flex ml-2" type="button" (click)="newScoreMeasurementCancel()">
                            <span class="material-icons text-light mr-1">remove</span>
                            Cancelar</button>
                        <button class="btn btn-primary d-flex ml-2" [disabled]="scoreMeasurementForm.invalid || loadingCompleteAssign">
                            <span class="material-icons text-light mr-1">add</span>
                            Guardar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <hr color="#67696b" />
    <form class="col-12" [formGroup]="nonQuantifiableForm" (ngSubmit)="newNonQuantifiable()" style="margin-top: 10px;">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center" >
                <h6>Estimaciones no cuantificables</h6>
                <button class="btn btn-primary d-flex" type="button" (click)="newNonQuantifiableRequest()">
                    <span class="material-icons text-light mr-1">add</span>
                    Agregar
                </button>
            </div>
        </div>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Evaluación</th>
                    <th>Instrumento</th>
                    <th>¿Qué evalúa?</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let nonQuantifiable of nonQuantifiables; let i = index">
                    <td>
                        <textarea class="form-control" type="text" value="{{nonQuantifiable.evaluation}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{nonQuantifiable.instrument}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{nonQuantifiable.evaluate}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <button class="btn btn-danger ml-2"  type="button" (click)="deleteNonQuantifiable(i)">Eliminar</button>
                    </td>
                    <hr *ngIf="i != nonQuantifiables.length-1">
                </tr>
                <tr *ngIf="nonQuantifiableRequest">
                    <td >
                        <input formControlName="nonQeEvaluation" type="text" class="form-control" id="nonQeEvaluation" [class.is-invalid]="nonQuantifiableForm.get('nonQeEvaluation').errors" />
                        <small *ngIf="nonQuantifiableForm.get('nonQeEvaluation').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="nonQuantifiableForm.get('nonQeEvaluation').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="nonQeInstrument" type="text" class="form-control" id="nonQeInstrument" [class.is-invalid]="nonQuantifiableForm.get('nonQeInstrument').errors" />
                        <small *ngIf="nonQuantifiableForm.get('nonQeInstrument').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="nonQuantifiableForm.get('nonQeInstrument').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="nonQeEvaluate" type="text" class="form-control" id="nonQeEvaluate" [class.is-invalid]="nonQuantifiableForm.get('nonQeEvaluate').errors" />
                        <small *ngIf="nonQuantifiableForm.get('nonQeEvaluate').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="nonQuantifiableForm.get('nonQeEvaluate').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <button class="btn btn-secondary d-flex ml-2" type="button" (click)="newNonQuantifiableCancel()">
                            <span class="material-icons text-light mr-1">remove</span>
                            Cancelar</button>
                        <button class="btn btn-primary d-flex ml-2" [disabled]="nonQuantifiableForm.invalid || loadingCompleteAssign">
                            <span class="material-icons text-light mr-1">add</span>
                            Guardar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>

<div class="row container-fluid card shadow px-0 mt-4 pt-4 pb-4 mx-0 mb-4">   
    <form class="col-12" [formGroup]="evidenceRecordForm" (ngSubmit)="newEvidenceRecord()">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h5>Administración de los instrumentos y registro de evidencias</h5>
                <button class="btn btn-primary d-flex" type="button" (click)="newEvidenceRecordRequest()">
                    <span class="material-icons text-light mr-1">add</span>
                    Agregar
                </button>
            </div>
        </div>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Evaluaciones</th>
                    <th>Indicador</th>
                    <th>Evidencias</th>
                    <th>Instrumento</th>
                    <th>Puntaje</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let evidenceRecord of evidenceRecords; let i = index">
                    <td>
                        <textarea class="form-control" type="text" value="{{evidenceRecord.evaluations}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{evidenceRecord.indicator}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{evidenceRecord.evidences}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{evidenceRecord.instrument}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{evidenceRecord.score}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <button class="btn btn-danger ml-2"  type="button" (click)="deleteEvidenceRecord(i)">Eliminar</button>
                    </td>
                    <hr *ngIf="i != evidenceRecords.length-1">
                </tr>
                <tr *ngIf="evidenceRecordRequest">
                    <td >
                        <input formControlName="evidenceRdEvaluations" type="text" class="form-control" id="evidenceRdEvaluations" [class.is-invalid]="evidenceRecordForm.get('evidenceRdEvaluations').errors" />
                        <small *ngIf="evidenceRecordForm.get('evidenceRdEvaluations').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="evidenceRecordForm.get('evidenceRdEvaluations').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="evidenceRdIndicator" type="text" class="form-control" id="evidenceRdIndicator" [class.is-invalid]="evidenceRecordForm.get('evidenceRdIndicator').errors" />
                        <small *ngIf="evidenceRecordForm.get('evidenceRdIndicator').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="evidenceRecordForm.get('evidenceRdIndicator').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="evidenceRdEvidences" type="text" class="form-control" id="evidenceRdEvidences" [class.is-invalid]="evidenceRecordForm.get('evidenceRdEvidences').errors" />
                        <small *ngIf="evidenceRecordForm.get('evidenceRdEvidences').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="evidenceRecordForm.get('evidenceRdEvidences').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="evidenceRdInstrument" type="text" class="form-control" id="evidenceRdInstrument" [class.is-invalid]="evidenceRecordForm.get('evidenceRdInstrument').errors" />
                        <small *ngIf="evidenceRecordForm.get('evidenceRdInstrument').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="evidenceRecordForm.get('evidenceRdInstrument').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="evidenceRdScore" type="text" class="form-control" id="evidenceRdScore" [class.is-invalid]="evidenceRecordForm.get('evidenceRdScore').errors" />
                        <small *ngIf="evidenceRecordForm.get('evidenceRdScore').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="evidenceRecordForm.get('evidenceRdScore').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <button class="btn btn-secondary d-flex ml-2" type="button" (click)="newEvidenceRecordCancel()">
                            <span class="material-icons text-light mr-1">remove</span>
                            Cancelar</button>
                        <button class="btn btn-primary d-flex ml-2" [disabled]="evidenceRecordForm.invalid || loadingCompleteAssign">
                            <span class="material-icons text-light mr-1">add</span>
                            Guardar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>

<div class="row container-fluid card shadow px-0 mt-4 pt-4 pb-4 mx-0 mb-4">
    <form class="col-12" [formGroup]="detailForm">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h5>Evaluación del aprendizaje</h5>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-12">
                <label for="interpretationOfAppraisals">Interpretación de apreciaciones y/o datos</label>
                <textarea formControlName="interpretationOfAppraisals" class="form-control" id="interpretationOfAppraisals" rows="1" [class.is-invalid]="detailForm.get('interpretationOfAppraisals').errors">
                </textarea>
                <small *ngIf="detailForm.get('interpretationOfAppraisals').errors?.required" class="form-text text-danger">Requerido.</small>
                <small *ngIf="detailForm.get('interpretationOfAppraisals').errors?.pattern" class="form-text text-danger">No valido.</small>
                <small *ngIf="detailForm.get('interpretationOfAppraisals').errors?.maxlength" class="form-text text-danger">Máximo 2000 caractéres.</small>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-12">
                <label for="judgmentsAndConclusions">Juicios y conclusiones valorativas</label>
                <textarea formControlName="judgmentsAndConclusions" class="form-control" id="judgmentsAndConclusions" rows="1" [class.is-invalid]="detailForm.get('judgmentsAndConclusions').errors">
                </textarea>
                <small *ngIf="detailForm.get('judgmentsAndConclusions').errors?.required" class="form-text text-danger">Requerido.</small>
                <small *ngIf="detailForm.get('judgmentsAndConclusions').errors?.pattern" class="form-text text-danger">No valido.</small>
                <small *ngIf="detailForm.get('judgmentsAndConclusions').errors?.maxlength" class="form-text text-danger">Máximo 2000 caractéres.</small>
            </div>
        </div>
    </form>
    <hr color="#67696b" />
    <form class="col-12" [formGroup]="resultsForm" (ngSubmit)="newResult()">
        <div class="row">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h6>Asignación, entrega y revisión de resultados</h6>
                <button class="btn btn-primary d-flex" type="button" (click)="newResultRequest()">
                    <span class="material-icons text-light mr-1">add</span>
                    Agregar
                </button>
            </div>
        </div>
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Tipo de evaluación</th>
                    <th>Periodo de aplicación</th>
                    <th>Periodo de revisión</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let result of results; let i = index">
                    <td>
                        <textarea class="form-control" type="text" value="{{result.evaluationType}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{result.applicationPeriod}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <textarea class="form-control" type="text" value="{{result.reviewPeriod}}" disabled>
                        </textarea>
                    </td>
                    <td>
                        <button class="btn btn-danger ml-2"  type="button" (click)="deleteResultRecord(i)">Eliminar</button>
                    </td>
                    <hr *ngIf="i != results.length-1">
                </tr>
                <tr *ngIf="resultRequest">
                    <td >
                        <input formControlName="resultEvaluationType" type="text" class="form-control" id="resultEvaluationType" [class.is-invalid]="resultsForm.get('resultEvaluationType').errors" />
                        <small *ngIf="resultsForm.get('resultEvaluationType').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="resultsForm.get('resultEvaluationType').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="resultApplicationPeriodn" type="text" class="form-control" id="resultApplicationPeriodn" [class.is-invalid]="resultsForm.get('resultApplicationPeriodn').errors" />
                        <small *ngIf="resultsForm.get('resultApplicationPeriodn').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="resultsForm.get('resultApplicationPeriodn').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <input formControlName="resultReviewPeriod" type="text" class="form-control" id="resultReviewPeriod" [class.is-invalid]="resultsForm.get('resultReviewPeriod').errors" />
                        <small *ngIf="resultsForm.get('resultReviewPeriod').errors?.required" class="form-text text-danger">Requerido.</small>
                        <small *ngIf="resultsForm.get('resultReviewPeriod').errors?.maxlength" class="form-text text-danger">Máximo 50 caractéres.</small>
                    </td>
                    <td>
                        <button class="btn btn-secondary d-flex ml-2" type="button" (click)="newResultCancel()">
                            <span class="material-icons text-light mr-1">remove</span>
                            Cancelar</button>
                        <button class="btn btn-primary d-flex ml-2" [disabled]="resultsForm.invalid || loadingCompleteAssign">
                            <span class="material-icons text-light mr-1">add</span>
                            Guardar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <hr color="#67696b" />
    <form class="col-12" (ngSubmit)="completeAssign()">
        <div class="row ">
            <div class="col-12 d-flex justify-content-end">
                <button class="btn btn-secondary" type="button" (click)="showDetailsCancel()" [disabled]="loadingCompleteAssign">Regresar</button>
                <button class="btn btn-primary ml-2" [disabled]="detailForm.invalid || loadingCompleteAssign || thematicUnits.length <=0 || 
                    scoreMeasurements.length <=0 || nonQuantifiables.length <=0 || evidenceRecords.length <=0 || results.length <=0">
                    <span *ngIf="loadingCompleteAssign" class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                    Completar asignación</button>
            </div>
        </div>
    </form>
</div>